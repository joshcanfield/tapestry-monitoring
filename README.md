Tapestry Monitoring
===================

Tapestry Monitoring is intended to be a lightweight, unobtrusive method
to introduce JMX performance metrics to any application built with the
[Apache Tapestry Web Framework](http://tapestry.apache.org]).

[javasimon](http://code.google.com/p/javasimon/) was chosen as the basis
for the metrics for it's ease of use, highly performant stopwatch functionality
and ready to use MBeans.

Monitoring functionality can be added to any
[IOC Service](http://tapestry.apache.org/defining-tapestry-ioc-services.html)
or [Component](http://tapestry.apache.org/component-classes.html) method. In the
simplest case the @Monitor annotation can simply be added to the method and
an MBean will automatically be created and registered using the tapestry-jmx
MBeanSupport.

Example
-------

    package org.example.testapp.pages;
    ...
    public class Index {

        @Monitor
        void onActivate(EventContext args) throws InterruptedException { }

        @Monitor
        Block onUpdateZone() {}
    }

This creates two JMX MBeans

    org.example.testapp:package=pages,name=Index,monitor=onActivate(EventContext),type=Monitor
    org.example.testapp:package=pages,name=Index,monitor=onUpdateZone,type=Monitor

Connecting to your service via [VisualVM](http://visualvm.java.net/) with the
[MBeans Browser](http://visualvm.java.net/plugins.html) you will see your monitor hierarchy:

* org.example.testapp
    * Monitor
        * pages
            * Index
                * onActivate(EventContext)
                * onUpdateZone()


### Naming your Monitor ###

If you'd like a little bit of control over your object name you can provide a name to the @Monitor

    package org.example.testapp.pages;
    ...
    public class Index {

        @Monitor("load_index_page")
        void onActivate(EventContext args) throws InterruptedException { }

        @Monitor("update_user_section")
        Block onUpdateZone() {}
    }

And now you can see

* org.example.testapp
    * Monitor
        * pages
            * Index
                * load\_index\_page
                * update\_user\_section

### Contributing a new naming strategy ###

Monitor names are generated by the [MonitorNameGenerator] [mng]. It is implemented as a [Strategy Builder][sb]
so that different strategies can be used per-class. The strategy match is done over the class hierarchy so you
can choose to configure a default strategy by configuring a naming strategy for Object.

  [sb]: http://tapestry.apache.org/strategybuilder-service.html
  [mng]: https://github.com/joshcanfield/tapestry-monitoring/blob/master/src/main/java/org/apache/tapestry5/monitor/MonitorNameGenerator.java

Example
-------

     @Contribute(MonitorNameGenerator.class)
     public static void simpleNameGenerator(MappedConfiguration<Class, MonitorNameGenerator> configuration) {
         configuration.add(Object.class, new MonitorNameGenerator {

         public String getMonitorName(Class owningClass, Method method) {
             return owningClass.getName() + "." + method.getName();
         }

         public ObjectName getJmxObjectName(Class owningClass, Method method) {
             try {
                 return new ObjectName("app:method=" + getMonitorName(owningClass, method));
             } catch (MalformedObjectNameException e) {
                 throw new RuntimeException(e);
             }
         }
    }

And VisualVM will show

* app
    * org.example.testapp.Index
        * onActivate
        * onUpdateZone

